# WedSnap — 사진 수집 서비스 기획서

## 📘 개요
**개발 목적**  
QR을 통해 초대받은 하객(접속자)이 사이트에 접속하여 본인 이름(또는 닉네임)을 입력하고 이미지를 업로드하면, 업로더별로 정리된 폴더 구조로 지정된 NAS에 안전하게 저장되는 서비스를 개발한다.  
신랑·신부(또는 이벤트 주최자)는 이후 NAS에서 사진을 확인·다운로드·관리할 수 있다.

**대상 사용자**
- **이벤트 주최자(수집 목적자, 관리자)** : QR을 생성 및 배포, 업로드된 사진을 관리  
- **하객(업로더)** : QR을 통해 사이트 접속, 이름 입력 후 사진 업로드  
- **운영자(관리자)** : 시스템 모니터링 및 유지보수

---

## 🧭 목차
1. 요구사항 요약 (MVP)
2. 사용자 흐름
3. 화면(페이지) 설계
4. NAS 저장 구조
5. 보안·인증·권한
6. 파일 처리 및 검증 정책
7. 저장 및 백업 정책
8. 운영 및 모니터링
9. CI/CD 및 배포
10. 테스트 및 QA 시나리오
11. 수용 기준
12. 위험요소 및 대응방안
13. 개발 우선순위
14. 별도 정리 (추후 검토 항목)

---

## 1. 🧩 요구사항 요약 (MVP)
- QR 링크를 통해 업로드 페이지 접속
- 업로더는 이름(또는 닉네임)을 입력 후 이미지 업로드
- 업로드된 이미지는 `수집자/업로더` 폴더 구조로 NAS에 저장
- 허용 확장자: 이미지 파일만 (`jpg`, `png`, `webp`)
- 비속어 필터 적용
- 중복 이름 처리: 자동 숫자 suffix 부여 (`홍길동(1)`)
- NAS 직접 노출 없이 서버 중계로 저장
- 관리자 UI에서 업로드 내역 및 파일 확인 가능

---

## 2. 👥 사용자 흐름

### 시나리오 A — 하객(업로더)
1. 초대장 QR 스캔 → 사이트 접속  
2. 이름 또는 닉네임 입력  
3. 이미지 선택 (여러 장 가능)  
4. 업로드 버튼 클릭  
5. 업로드 완료 메시지 표시 및 썸네일 확인

### 시나리오 B — 수집자(신랑·신부)
1. 관리자 페이지 접속  
2. 이벤트 선택 후 업로더별 업로드 이미지 목록 확인  
3. 필요 시 다운로드 및 삭제 가능

---

## 3. 💻 화면(페이지) 설계

### 업로더 페이지
- 입력: 이름/닉네임 (필수)
- 비속어 필터 적용
- 이미지 업로드 UI  
  - 파일 드래그 앤 드롭 지원  
  - 썸네일 미리보기  
  - 업로드 진행률 표시  
- 업로드 제한 안내 (예: “최대 20MB, 최대 40장”)
- 결과 메시지 및 재업로드 버튼

### 관리자 페이지
- 이벤트 목록 / 업로더 목록
- 업로더 클릭 시 업로드한 이미지 목록
- 다운로드 / 삭제 기능
- 필터(날짜, 업로더명)
- 용량 통계, 업로드 수 통계 표시

---

## 4. 🗂 NAS 저장 구조
```
  /nas/wedsnap/
    /event-<eventId>/
      /<uploaderName>/
        uuid1.jpg
        uuid2.jpg
```
- 업로더별 폴더 생성으로 누가 올렸는지 확인 가능
- 이벤트별 폴더로 수집자 구분
- NAS 내부만 접근 가능, 외부는 서버를 통해 중계

---

## 5. 🔒 보안·인증·권한
- QR 토큰 기반 접근 (`UUID` 또는 JWT)
- HTTPS 전송 필수
- NAS는 내부망에 존재, 서버만 접근 가능
- 입력값(이름/닉네임) 검증 및 비속어 필터 적용
- 이미지 MIME/파일 헤더 검사
- 업로더별 rate limit 설정 (DoS 방지)
- 관리자 인증(패스워드/토큰) 기반 관리 페이지 접근

---

## 6. 📁 파일 처리 및 검증 정책
- 허용 확장자: `jpg`, `jpeg`, `png`, `webp`, 'heif'
- 파일당 최대 크기: **20MB**
- 1회 업로드 시 최대 **40개**
- 총 업로드 용량 제한: **800MB**
- 업로드 전 MIME 검사 및 파일 헤더 시그니처 확인
- GPS/EXIF 정보 제거 (개인정보 보호)
- 업로드 완료 후 썸네일 자동 생성

## 6-1. ⚡ 동시 업로드 처리

- **목적**: 여러 사용자가 동시에 업로드할 때 서버와 NAS가 안정적으로 처리되도록 설계
- **제한 사항**
  - 1회 업로드 최대 파일 수: 40장
  - 파일당 최대 크기: 20MB
  - 동시 업로드 제한: 서버가 처리 가능한 동시 업로드 수 설정 (예: 50명)
- **처리 방법**
  1. **서버 큐잉**
     - 업로드 요청을 서버 내 큐에 저장 후 순차 처리
     - NAS I/O 병목 방지
  2. **비동기 처리**
     - 업로드 후 응답을 즉시 반환하고, 서버가 백그라운드에서 NAS 저장 진행
     - 업로드 상태는 썸네일/진행률로 표시
  3. **임시 스토리지 활용**
     - 서버 디스크 또는 S3와 같은 임시 스토리지에 먼저 저장 후 NAS로 이동
     - NAS 부하 분산
  4. **Rate Limit / Throttle**
     - 사용자별 업로드 속도 제한
     - 일정 시간 내 요청 횟수 제한
- **모니터링**
  - NAS 용량 및 I/O 모니터링
  - 서버 업로드 큐 길이 감시
  - 경고 알림: Slack/Email

---

## 7. 💾 저장 및 백업 정책
- NAS에 업로드 즉시 저장
- 백업: NAS 스냅샷 일간/주간 백업 + 클라우드 오프사이트 백업
- 보존 기간: 기본 1년, 관리자 설정 가능
- 삭제 시 로그 기록 및 복구 절차 제공

---

## 8. 📡 운영 및 모니터링
- 업로드 성공/실패 로그 기록
- NAS 용량 모니터링 (80%, 90% 경고)
- Slack / 이메일 알림
- 업로드 실패 알림 및 자동 재시도 로직
- ClamAV로 악성 파일 검사

---

## 9. 🚀 CI/CD 및 배포
- **CI:** GitHub Actions (테스트 → 빌드 → Docker push)
- **CD:** Docker 컨테이너로 NAS 연결 서버에 배포
- 환경 변수 관리: GitHub Secrets
- 배포 환경: staging / production 분리

---

## 10. 🧪 테스트 및 QA 시나리오

### 기능 테스트
- 정상 업로드 및 NAS 저장 확인
- 비허용 확장자 거부
- 파일 크기 초과 오류 처리
- 동일 이름 업로더 충돌 해결
- 썸네일 생성 확인

### 보안 테스트
- 토큰 만료/조작 검증
- 악성 파일 업로드 차단
- Rate limit 동작 확인

### 부하 테스트
- 100명 동시 업로드 시 안정성 확인
- NAS I/O 및 서버 메모리 사용량 점검

---

## 11. ✅ 수용 기준
- QR로 접속하여 이름 입력 및 사진 업로드 가능
- NAS에 올바른 경로로 저장
- 확장자 및 용량 제한 정상 작동
- 관리자 페이지에서 업로더별 조회 가능
- 중복 이름 자동 처리
- HTTPS 및 토큰 인증 정상 동작

---

## 12. ⚠️ 위험요소 및 대응방안
| 위험요소 | 대응방안 |
|-----------|-----------|
| NAS 직접 노출 | 서버 중계 방식으로 내부망 유지 |
| 스팸/대량 업로드 | 토큰 만료, Rate-limit, Captcha |
| 개인정보 노출(EXIF) | 업로드 시 자동 제거 |
| 디스크 용량 초과 | 관리자 알림 및 업로드 제한 |
| 악성 파일 업로드 | ClamAV 검사 및 격리 처리 |

---

## 13. 🧭 개발 우선순위

### MVP (1차)
1. 업로드 페이지 (QR 접속)
2. 이미지 업로드 + NAS 저장
3. 이름 중복 처리
4. 관리자 파일 목록 확인
5. HTTPS 및 토큰 검증

### 확장 (2차 이후)
- 이미지 자동 변환 (WebP)
- resumable upload
- NSFW 필터
- 통계 리포트
- 오브젝트 스토리지 연동 (S3)

---

## 14. 📎 별도 정리 / 추후 검토 항목
- 얼굴 인식 자동 태깅
- 사용자 계정 시스템
- 결제 / 유료 기능
- CDN 연동
- AI 기반 자동 분류
- 접근성(ARIA) 개선

---

## 15. 📚 부록

### 기본 설정 요약
| 항목 | 값 |
|------|----|
| 파일당 최대 크기 | 20MB |
| 업로드 최대 개수 | 40개 |
| 허용 확장자 | jpg, jpeg, png, webp, heif |
| 총 업로드 용량 제한 | 800MB |
| EXIF 처리 | GPS 등 개인정보 제거 |
| 바이러스 검사 | ClamAV |
| 토큰 만료 기간 | 7~30일 |

### 기술 스택 (권장)
- **Frontend:** React / Vite  
- **Backend:** Spring Boot  
- **Storage:** NAS / S3  
- **CI/CD:** GitHub Actions  
- **Monitoring:** Prometheus + Grafana  
- **Reverse Proxy:** Nginx / Traefik  
- **Virus Scan:** ClamAV
